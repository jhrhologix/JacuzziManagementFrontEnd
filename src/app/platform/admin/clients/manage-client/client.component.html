<!--
  CLIENT MANAGEMENT COMPONENT TEMPLATE
  
  PURPOSE: This template provides the user interface for the client management system,
  including client search, selection, and detailed information display.
  
  STRUCTURE:
  1. LEFT COLUMN (col-lg-4): Client search and list
     - Search filter dropdown (Name, Spa Number, Service Call, etc.)
     - Search input with popup results overlay
     - Main client list table with sorting
  2. RIGHT COLUMN (col-lg-8): Client details and forms
     - Client information form
     - Spa details management
     - Service call history and upcoming calls
  
  RECENT IMPROVEMENTS:
  - Added blur event to search input for better popup management
  - Enhanced search popup visibility controls
  - Improved client selection workflow
  
  KEY FEATURES:
  - Multi-criteria client search
  - Search popup with clickable results
  - Responsive client list with sorting
  - Comprehensive client form with validation
  - Spa details association
  - Service call tracking
  - Multi-language support
-->
<section class="client_list_main">
    <div class="row position-relative">
        <div class="col-lg-4">
            <div class="search_bar">
                <div class="select_drop">
                    <select id="search" class="form-select" [(ngModel)]="selectedFilter" (change)="onChange()">
                        <option value="Name">{{ 'HEADER.NAME' | translate }}</option>
                        <option>{{ 'HEADER.Spa_Number' | translate }}</option>
                        <option>{{ 'HEADER.Service_call' | translate }}</option>
                        <option>{{ 'HEADER.Telephone' | translate }}</option>
                        <option>{{ 'HEADER.Client_Number' | translate }}</option>
                        <option>{{ 'HEADER.Address' | translate }}</option>
                    </select>
                </div>
                <div class="input-group mb-4 serch">
                    <input (keyup)="applyFilter($event)" (keydown)="preventMultipleSpaces($event); onSearchEnter($event)" (blur)="onSearchBlur()" placeholder=" {{ 'HEADER.SEARCH' | translate }} "
                        [(ngModel)]="searchQuery" class="form-control bg-none border-0">
                    <button (click)="removefilter()" class="btn btn-outline-primary searchbuttonfilter">
                        <!-- {{ 'HEADER.Remove_Button' | translate }}  -->
                        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                            width="30" height="30" x="0" y="0" viewBox="0 0 512 512"
                            style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                            <g>
                                <path
                                    d="M288.064 435.828a7.5 7.5 0 0 0-7.5 7.5v26.124c0 .119 0 .299-.259.448-.26.15-.415.058-.517-.001l-72.207-42.121a16.604 16.604 0 0 1-8.21-14.294V298.521h48.613a7.5 7.5 0 0 0 0-15h-52.912L25.076 106.135H454.86l-80.025 83.504c-2.866 2.991-2.765 7.738.226 10.604s7.738 2.765 10.604-.226l83.271-86.892a39.388 39.388 0 0 0 11-27.375V50.538c0-12.976-10.557-23.532-23.532-23.532H23.532C10.557 27.006 0 37.562 0 50.538v35.213c0 10.251 3.906 19.974 11 27.375l173.372 180.909v119.448c0 11.177 5.998 21.619 15.652 27.251l72.207 42.121c2.444 1.426 5.13 2.139 7.816 2.139 2.653 0 5.307-.696 7.729-2.087 4.877-2.801 7.788-7.831 7.788-13.455v-26.124a7.5 7.5 0 0 0-7.5-7.5zM15 50.538c0-4.705 3.828-8.532 8.532-8.532h432.871c4.705 0 8.532 3.827 8.532 8.532v35.213c0 1.831-.207 3.633-.598 5.384H15.598A24.686 24.686 0 0 1 15 85.751z"
                                    fill="#ffffff" opacity="1" data-original="#000000" class=""></path>
                                <path
                                    d="M392.274 219.393c-66.017 0-119.726 53.709-119.726 119.726s53.709 119.726 119.726 119.726S512 405.136 512 339.119s-53.708-119.726-119.726-119.726zm0 224.451c-57.746 0-104.726-46.98-104.726-104.726s46.98-104.726 104.726-104.726S497 281.373 497 339.119c0 57.745-46.979 104.725-104.726 104.725z"
                                    fill="#ffffff" opacity="1" data-original="#000000" class=""></path>
                                <path
                                    d="M445.674 285.719a7.497 7.497 0 0 0-10.606 0l-42.794 42.793-42.794-42.793a7.497 7.497 0 0 0-10.606 0 7.5 7.5 0 0 0 0 10.606l42.794 42.793-42.794 42.793a7.5 7.5 0 0 0 0 10.606c1.464 1.465 3.384 2.197 5.303 2.197s3.839-.732 5.303-2.197l42.794-42.793 42.794 42.793c1.464 1.465 3.384 2.197 5.303 2.197s3.839-.732 5.303-2.197a7.5 7.5 0 0 0 0-10.606l-42.794-42.793 42.794-42.793a7.497 7.497 0 0 0 0-10.606z"
                                    fill="#ffffff" opacity="1" data-original="#000000" class=""></path>
                            </g>
                        </svg>
                    </button>
                </div>

                <div id="loader" class="loader" *ngIf="isLoading">
                    <div class="load">
                    </div>
                </div>

                <!-- Removed old popup search table - now using main table with search results -->

            </div>


            <div class="table-responsive">
                <table mat-table [dataSource]="clientlist" class="table" matSort (matSortChange)="sortData($event)"
                    matSortDirection="desc">

                    <ng-container matColumnDef="clientNumber">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'HEADER.CLIENT_ID' | translate }}</th>
                        <td mat-cell *matCellDef="let element" (click)="selectClient(element)"> {{element.clientNumber}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="firstName">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'HEADER.FIRST_NAME' | translate }}
                        </th>
                        <td mat-cell *matCellDef="let element" (click)="selectClient(element)"> {{element.firstName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="lastName">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'HEADER.LAST_NAME' | translate }}
                        </th>
                        <td mat-cell *matCellDef="let element" (click)="selectClient(element)"> {{element.lastName}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="spouseFirstName">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'HEADER.SpouseFirstName' | translate }}</th>
                        <td mat-cell *matCellDef="let element" (click)="selectClient(element)">
                            {{element.spouseFirstName}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="spouseLastName">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'HEADER.SpouseLastName' | translate }}</th>
                        <td mat-cell *matCellDef="let element" (click)="selectClient(element)">
                            {{element.spouseLastName}}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
                        [ngClass]="{'selected-client-highlight': selectedClientForHighlighting && (row.clientID === selectedClientForHighlighting.clientID || row.clientID === selectedClientForHighlighting.ClientID || row.clientNumber === selectedClientForHighlighting.clientNumber || row.clientNumber === selectedClientForHighlighting.ClientNumber)}"
                        class="client-row">
                </table>
            </div>

        </div>
        <div class="col-lg-8">
            <div class="bg-white">
                <h4 [ngClass]="{ 'justify-content-end': !isBlackListed }">

                    <ng-container *ngIf="isBlackListed"><span>Black Listed</span> </ng-container>

                    <div class="btnsdiv d-flex gap-2">
                        <button (click)="addNewClient()" class="btn btn-outline-primary">{{ 'HEADER.Client_Button' |
                            translate }}</button>
                        <button (click)="ScRedirect()" class="btn btn-primary">{{ 'HEADER.Service_Call' | translate
                            }}</button>
                    </div>


                </h4>
                <div class="form_main">

                    <form [formGroup]="clientForm" autocomplete="off" (ngSubmit)="onSubmit()">
                        <div class="row mb-3">
                            <div class="col-md-4 mb-2">
                                <label for="nom" class="form-label">{{ 'HEADER.Client_Number' | translate }} <span class="mendatory-symb">*</span>
                                </label>
                                <input #firstInput type="text" (keypress)="blockwhitespaces($event)"
                                    style="text-transform:uppercase" formControlName="clientNumber" class="form-control"
                                    maxlength="40" id="nom" placeholder="{{ 'HEADER.Client_Number' | translate }}">
                                <div *ngIf="clientForm.get('clientNumber')?.invalid && (clientForm.get('clientNumber')?.touched || clientForm.get('clientNumber')?.dirty)"
                                    class="text-danger">
                                    <span *ngIf="clientForm.get('clientNumber')?.hasError('required')">{{
                                        'HEADER.REQUIRED_ClientNumber' | translate }}</span>

                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="nom" class="form-label">{{ 'HEADER.FIRST_NAME' | translate }} <span class="mendatory-symb">*</span></label>
                                <input type="text" (keypress)="blockwhitespaces($event)"
                                    style="text-transform:uppercase" formControlName="firstName" class="form-control"
                                    id="nom" maxlength="40" placeholder="{{ 'HEADER.FIRST_NAME' | translate }}" >
                                <div *ngIf="clientForm.get('firstName')?.invalid && (clientForm.get('firstName')?.touched || clientForm.get('firstName')?.dirty)"
                                    class="text-danger">
                                    <span *ngIf="clientForm.get('firstName')?.hasError('required')">{{'HEADER.REQUIRED_FirstName' | translate }}</span>

                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="prenom" class="form-label">{{ 'HEADER.LAST_NAME' | translate }} <span class="mendatory-symb">*</span></label>
                                <input type="text" (keypress)="blockwhitespaces($event)"
                                    style="text-transform:uppercase" maxlength="40" formControlName="lastName"
                                    class="form-control" id="prenom" placeholder="{{ 'HEADER.LAST_NAME' | translate }}">
                                <div *ngIf="clientForm.get('lastName')?.invalid && (clientForm.get('lastName')?.touched || clientForm.get('lastName')?.dirty)"
                                    class="text-danger">
                                    <span *ngIf="clientForm.get('lastName')?.hasError('required')">{{
                                        'HEADER.REQUIRED_LastName'
                                        | translate }}</span>

                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="nom-conjoint" class="form-label">{{ 'HEADER.CONJOINT_LAST_NAME' | translate
                                    }}</label>
                                <input type="text" style="text-transform:uppercase" formControlName="spouseFirstName"
                                    class="form-control" maxlength="40" id="nom-conjoint"
                                    placeholder="{{ 'HEADER.CONJOINT_LAST_NAME' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="prenom-conjoint" class="form-label">{{ 'HEADER.CONJOINT_FIRST_NAME' |
                                    translate }}</label>
                                <input type="text" (keypress)="blockwhitespaces($event)"
                                    style="text-transform:uppercase" maxlength="40" formControlName="spouseLastName"
                                    class="form-control" id="prenom-conjoint"
                                    placeholder="{{ 'HEADER.CONJOINT_FIRST_NAME' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="primaire-courriel" class="form-label">{{ 'HEADER.EMAIL_PRIMARY' | translate
                                    }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="email"
                                    style="text-transform:uppercase" maxlength="50" formControlName="primaryEmail"
                                    class="form-control" id="primaire-courriel"
                                    placeholder="{{ 'HEADER.EMAIL_PRIMARY1' | translate }}"
                                    [ngClass]="{'is-invalid': primaryEmail?.invalid}">
                                <div *ngIf="primaryEmail?.invalid" class="invalid-feedback">
                                    <!-- <span *ngIf="primaryEmail?.errors?.['required']">{{ 'HEADER.EMAIL_INVALID' |
                                        translate }}</span> -->
                                    <span *ngIf="primaryEmail?.errors?.['email']">{{ 'HEADER.EMAIL_INVALID' | translate
                                        }}</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="secondaire-courriel" class="form-label">{{ 'HEADER.EMAIL_SECONDARY' |
                                    translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="email" maxlength="50"
                                    style="text-transform:uppercase" formControlName="secondaryEmail"
                                    class="form-control" id="secondaire-courriel"
                                    placeholder="{{ 'HEADER.EMAIL_SECONDARY1' | translate }}"
                                    [ngClass]="{'is-invalid': secondaryEmail?.invalid }">
                                <div *ngIf="secondaryEmail?.invalid" class="invalid-feedback">
                                    <!-- <span *ngIf="secondaryEmail?.errors?.['email']">{{ 'HEADER.EMAIL_INVALID' |
                                        translate }}</span> -->
                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="app" class="form-label">{{ 'HEADER.APP' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text" maxlength="15"
                                    style="text-transform:uppercase" formControlName="app" class="form-control" id="app"
                                    placeholder="{{ 'HEADER.APP' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="civique" class="form-label">{{ 'HEADER.CIVIQUE' | translate }}</label>
                                <input maxlength="50" (keypress)="blockwhitespaces($event)" type="text"
                                    style="text-transform:uppercase" formControlName="civic" class="form-control"
                                    id="civique" placeholder="{{ 'HEADER.CIVIQUE' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="rue" class="form-label">{{ 'HEADER.RUE' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" maxlength="50" type="text"
                                    style="text-transform:uppercase" formControlName="street" class="form-control"
                                    id="rue" placeholder="{{ 'HEADER.RUE' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="ville" class="form-label">{{ 'HEADER.VILLE' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text"
                                    style="text-transform:uppercase" formControlName="city" class="form-control"
                                    id="ville" maxlength="40" placeholder="{{ 'HEADER.VILLE' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2" *ngIf="currentLanguage == 'en'">
                                <label for="province" class="form-label">{{ 'HEADER.PROVINCE' | translate }}</label>
                                <select class="form-select" formControlName="province">
                                    <option *ngFor="let option of provinces" [value]="option.id">{{
                                        option.name }}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-2" *ngIf="currentLanguage == 'fr'">
                                <label for="province" class="form-label">{{ 'HEADER.PROVINCE' | translate }}</label>
                                <select class="form-select" formControlName="province">
                                    <option *ngFor="let option of provinces" [value]="option.id">{{
                                        option.value }}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="code-postal" class="form-label">{{ 'HEADER.POSTAL_CODE' | translate
                                    }}</label>
                                <input (keypress)="blockwhitespaces($event)" (input)="formatPostalCode($event)"
                                    type="text" style="text-transform:uppercase" maxlength="8"
                                    formControlName="postalCode" class="form-control" id="code-postal"
                                    placeholder="{{ 'HEADER.POSTAL_CODE' | translate }}">
                            </div>
                            <!--<div class="col-md-4 mb-2">
                                <label for="zone" class="form-label">{{ 'HEADER.ZONE' | translate }} <span class="mendatory-symb">*</span></label>
                                <select class="form-select" formControlName="area">
                                    <option value="" disabled selected>{{ 'HEADER.SelectArea' | translate }}</option>
                                    <option *ngFor="let option of area" [value]="option.id">{{
                                        option.name }}
                                    </option>
                                </select>
                                <div *ngIf="clientForm.get('area')?.invalid && (clientForm.get('area')?.touched || clientForm.get('area')?.dirty)"
                                    class="text-danger">
                                    <span *ngIf="clientForm.get('area')?.hasError('required')">{{ 'HEADER.REQUIRED_Area'
                                        |
                                        translate }}</span>

                                </div>
                            </div>-->
                            <!-- <div class="col-md-4 mb-2">
                                <label for="maison" class="form-label">{{ 'HEADER.BLANK1' | translate }}</label>
                                <select class="form-select" style="text-transform:uppercase" formControlName="house"
                                    (change)="onHouseChange($event)">
                                    <option [value]="1">House</option>
                                    <option [value]="2">Mobile Number</option>
                                </select>
                            </div> -->
                            <div class="col-md-4 mb-2">
                                <label for="portable" class="form-label">{{ 'HEADER.MOBILE' | translate }} <span class="mendatory-symb">*</span> </label>
                                <input (keypress)="blockwhitespaces($event)" type="tel" appPhoneMask
                                (input)="removeBraces($event)" style="text-transform:uppercase" maxlength="16"
                                    formControlName="streetNumber" class="form-control" id="portable"
                                    placeholder="{{ 'HEADER.BLANK' | translate }}">

                                <div *ngIf="clientForm.get('streetNumber')?.invalid && (clientForm.get('streetNumber')?.touched || clientForm.get('streetNumber')?.dirty)"
                                    class="text-danger">
                                    <span *ngIf="clientForm.get('streetNumber')?.hasError('required')">
                                        {{ 'HEADER.REQUIRED_MOBILENUMBER' | translate }}</span>

                                </div>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="tele1" class="form-label">{{ 'HEADER.PHONE1' | translate }}</label>
                                <input (input)="removeBraces($event)" (keypress)="blockwhitespaces($event)" type="tel"
                                    appPhoneMask style="text-transform:uppercase" formControlName="home" maxlength="16"
                                    class="form-control" id="tele1" placeholder="{{ 'HEADER.Phone' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="ext1" class="form-label">{{ 'HEADER.EXT' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text" maxlength="15"
                                    style="text-transform:uppercase" formControlName="ext1" class="form-control"
                                    id="ext1" placeholder="{{ 'HEADER.EXT' | translate }}">

                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="tele2" class="form-label">{{ 'HEADER.PHONE2' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="tel" appPhoneMask
                                    (input)="removeBraces($event)" style="text-transform:uppercase"
                                    formControlName="spouse" maxlength="16" class="form-control" id="tele2"
                                    placeholder="{{ 'HEADER.Phone' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="ext2" class="form-label">{{ 'HEADER.EXT' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text"
                                    style="text-transform:uppercase" maxlength="15" formControlName="ext2"
                                    class="form-control" id="ext2" placeholder="{{ 'HEADER.EXT' | translate }}">

                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="tele3" class="form-label">{{ 'HEADER.PHONE3' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="tel" appPhoneMask
                                    style="text-transform:uppercase" formControlName="work" maxlength="16"
                                    class="form-control" id="tele3" placeholder="{{ 'HEADER.Phone' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="ext3" class="form-label">{{ 'HEADER.EXT' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text"
                                    style="text-transform:uppercase" formControlName="ext3" class="form-control"
                                    id="ext3" maxlength="15" placeholder="{{ 'HEADER.EXT' | translate }}">

                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="tele4" class="form-label">{{ 'HEADER.PHONE4' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="tel" appPhoneMask
                                    style="text-transform:uppercase" formControlName="other" maxlength="16"
                                    class="form-control" id="tele4" placeholder="{{ 'HEADER.Phone' | translate }}">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="ext4" class="form-label">{{ 'HEADER.EXT' | translate }}</label>
                                <input (keypress)="blockwhitespaces($event)" type="text"
                                    style="text-transform:uppercase" maxlength="15" formControlName="ext4"
                                    class="form-control" id="ext4" placeholder="{{ 'HEADER.EXT' | translate }}">

                            </div>
                        </div>

                        <div class="row mb-3">

                            <div class="col-md-4">
                                <label for="black-list" class="form-label hide_label">{{ 'HEADER.BLACK_LIST' | translate
                                    }}</label>
                                <div class="form-check">
                                    <input (keypress)="blockwhitespaces($event)" class="form-check-input"
                                        formControlName="blackList" type="checkbox" id="black-list">
                                    <label class="form-check-label" for="black-list">{{ 'HEADER.BLACK_LIST' | translate
                                        }}</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="black-list" class="form-label hide_label">{{ 'HEADER.BLACK_LIST' | translate
                                    }}</label>
                                <div class="form-check">
                                    <input class="form-check-input" formControlName="ExternalBreaker" type="checkbox"
                                        id="externalbreaker">
                                    <label class="form-check-label" for="externalbreaker">{{ 'HEADER.ELECTRICAL' |
                                        translate
                                        }}</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="spa-leve" class="form-label hide_label">{{ 'HEADER.SPA_LEVE' | translate
                                    }}</label>
                                <div class="form-check">
                                    <input (keypress)="blockwhitespaces($event)" class="form-check-input"
                                        formControlName="raisedSpa" type="checkbox" id="spa-leve">
                                    <label class="form-check-label" for="spa-leve">{{ 'HEADER.SPA_LEVE' | translate
                                        }}</label>
                                </div>
                            </div>
                        </div>

                        <!-- Conjoint Fields -->
                        <div class="row mb-3">
                            <div class="col-md-8 ">
                                <label class="pb-2"> {{ 'HEADER.ContactUs' | translate }} </label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" formControlName="emailClient"
                                                type="checkbox" id="emailClient">
                                            <label class="form-check-label" for="emailClient">{{ 'HEADER.EMAIL_CLIENT' |
                                                translate
                                                }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" formControlName="sms" type="checkbox"
                                                id="sms">
                                            <label class="form-check-label" for="sms">{{ 'HEADER.SMS' | translate
                                                }}</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="langPref" class="form-label">{{ 'HEADER.LANGUAGE_PREFERENCE' | translate }}</label>
                                <select class="form-select" formControlName="langPref" id="langPref">
                                    <option value="fr">Français</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>


                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="notes" class="form-label">{{ 'HEADER.NOTES' | translate }}</label>
                                <textarea class="form-control" style="text-transform:uppercase" formControlName="notes"
                                    maxlength="1000" id="notes" rows="3"
                                    placeholder="{{ 'HEADER.NOTES' | translate }}"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="commentaires" class="form-label">{{ 'HEADER.COMMENTS' | translate }}</label>
                                <textarea class="form-control" style="text-transform:uppercase"
                                    formControlName="comments" maxlength="1000" id="commentaires" rows="3"
                                    placeholder="{{ 'HEADER.COMMENTS' | translate }}"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12 gap-3 d-flex align-items-end justify-content-end submit_btns">
                                <button type="submit" class="btn btn-primary" [disabled]="isButtonDisabled">
                                    {{ selectedClient1 ? ('HEADER.Register' | translate) : ('HEADER.Update' | translate)
                                    }}
                                </button>
                                <button (click)="actionbutton('deleteclient')" type="button" class="btn btn-danger"
                                    [disabled]="isDeleteButtonDisabled">{{ 'HEADER.Delete' | translate }}</button>
                            </div>
                        </div>
                    </form>

                </div>


            </div>
        </div>
    </div>

    <ng-container *ngIf="isAddingNewClient">
        <ng-container>

            <div class="row">
                <div class="col-md-12">
                    <h4>{{ 'HEADER.PAST_CALLS' | translate }}</h4>
                    <div class="table-responsive">
                        <table mat-table [dataSource]="dataSource" class="table">

                            <ng-container matColumnDef="serviceCallNumber">
                                <th mat-header-cell *matHeaderCellDef>{{ 'HEADER.Service_Call_Number' | translate }}
                                </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.serviceCallNumber}} </td>
                            </ng-container>
                            <ng-container matColumnDef="receptionDate">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Reception_Date' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.receptionDate | date:'yyyy/MM/dd'}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="placementDate">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.PLACEMENT' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.placementDate | date:'yyyy/MM/dd'}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="issueDescription">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Issue_Description' | translate }}
                                </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.issueDescription}} </td>
                            </ng-container>
                            <ng-container matColumnDef="serviceCallDescription">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Service_Call_Description' | translate
                                    }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.serviceCallDescription}} </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns1"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns1;"></tr>
                        </table>
                        <mat-paginator #oldServicePaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <h4>{{ 'HEADER.NEXT_CALLS' | translate }}</h4>
                    <div class="table-responsive">
                        <table mat-table [dataSource]="newServicecallData" class="table">

                            <ng-container matColumnDef="serviceCallNumber">
                                <th mat-header-cell *matHeaderCellDef>{{ 'HEADER.Service_Call_Number' | translate }}
                                </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.serviceCallNumber}} </td>
                            </ng-container>
                            <ng-container matColumnDef="receptionDate">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Reception_Date' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.receptionDate | date:'yyyy/MM/dd'}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="placementDate">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.PLACEMENT' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.placementDate | date:'yyyy/MM/dd'}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="issueDescription">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Issue_Description' | translate }}
                                </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.issueDescription}} </td>
                            </ng-container>
                            <ng-container matColumnDef="serviceCallDescription">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Service_Call_Description' | translate
                                    }} </th>
                                <td mat-cell *matCellDef="let element" (click)="servicecall(element)">
                                    {{element.serviceCallDescription}} </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns1"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns1;"></tr>
                        </table>
                        <mat-paginator #newServicecallPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <h4>{{ 'HEADER.SPAS' | translate }}
                        <button (click)="addnewSpaDetail()" data-bs-toggle="modal" data-bs-target="#addnewspa"
                            class="btn btn-outline-primary">{{ 'HEADER.ADD_SPAS' | translate }} </button>
                    </h4>
                    <div class="table-responsive">
                        <table mat-table [dataSource]="spaDetailsdataSource" class="table">

                            <ng-container matColumnDef="spaBrandName">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.SPA_BRAND_NAME' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="getSpaDetailsByClientId(element.spaId)"
                                    data-bs-toggle="modal" data-bs-target="#addnewspa"> {{element.spaBrandName}} </td>
                            </ng-container>
                            <ng-container matColumnDef="spaModelName">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.Spa_Model_Name' | translate }} </th>
                                <td mat-cell *matCellDef="let element" (click)="getSpaDetailsByClientId(element.spaId)"
                                    data-bs-toggle="modal" data-bs-target="#addnewspa"> {{element.spaModelName}} </td>
                            </ng-container>
                            <ng-container matColumnDef="poolSpecialistName">
                                <th mat-header-cell *matHeaderCellDef> {{ 'HEADER.PoolSpecialistNAme' | translate }}
                                </th>
                                <td mat-cell *matCellDef="let element" (click)="getSpaDetailsByClientId(element.spaId)"
                                    data-bs-toggle="modal" data-bs-target="#addnewspa"> {{element.poolSpecialistName}}
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
                        </table>
                        <mat-paginator #spaPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>

                    </div>
                </div>
            </div>
        </ng-container>
    </ng-container>
</section>



<div class="modal fade" id="addnewspa" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"> {{ 'HEADER.ADD_SPAS' | translate }} </h5>
                <button type="button" class="btn-close" id="btnsam" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="spaForm" autocomplete="off" (ngSubmit)="onSubmitspa()">
                    <div class="row" class="form_list">
                        <div class="col-md-12">
                            <label for="zone" class="form-label">{{ 'HEADER.SpaBrandLabel' | translate }}</label>
                            <select class="form-select" (change)="onSpaBrandChange($event)"
                                formControlName="spaBrandLabel">
                                <option value="" disabled selected>Select Brand</option>
                                <option *ngFor="let option of spaBrands" [value]="option.id">
                                    {{option.value }}
                                </option>
                            </select>
                            <div *ngIf="spaForm.get('spaBrandLabel')?.invalid && (spaForm.get('spaBrandLabel')?.touched || spaForm.get('spaBrandLabel')?.dirty)"
                                class="text-danger">
                                <span *ngIf="spaForm.get('spaBrandLabel')?.hasError('required')">{{
                                    'HEADER.REQUIRED_SpaBrand' |
                                    translate }}</span>

                            </div>
                        </div>
                        <div class="col-md-12">
                            <label for="zone" class="form-label">{{ 'HEADER.SpaModelLabel' | translate }}</label>
                            <select class="form-select" formControlName="spaModelLabel">
                                <option value="" disabled selected>Select Model</option>
                                <option *ngFor="let option of spaModel" [value]="option.id">
                                    {{option.value }}

                                </option>
                            </select>
                            <div *ngIf="spaForm.get('spaModelLabel')?.invalid && (spaForm.get('spaModelLabel')?.touched || spaForm.get('spaModelLabel')?.dirty)"
                                class="text-danger">
                                <span *ngIf="spaForm.get('spaModelLabel')?.hasError('required')">{{
                                    'HEADER.REQUIRED_SpaModel' |
                                    translate }}</span>
                            </div>
                            <!-- <div *ngIf="!isSpaModelValid()">
                                <span>N/A</span>
                            </div> -->
                        </div>
                        <div class="col-md-12">
                            <label for="zone" class="form-label">{{ 'HEADER.PoolSpecialistNAme' | translate }}</label>
                            <select class="form-select" formControlName="poolSpecialistNAme">
                                <option value="" disabled selected>Select Spa Vendor</option>
                                <option [value]="0">{{ 'HEADER.None' | translate }}</option>
                                <option *ngFor="let option of poolSpecialist" [value]="option.id">
                                    {{option.value }}

                                </option>
                            </select>
                            <div *ngIf="spaForm.get('poolSpecialistNAme')?.invalid && (spaForm.get('poolSpecialistNAme')?.touched || spaForm.get('poolSpecialistNAme')?.dirty)"
                                class="text-danger">
                                <span *ngIf="spaForm.get('poolSpecialistNAme')?.hasError('required')">{{
                                    'HEADER.REQUIRED_Pool Specialist' |
                                    translate }}</span>

                            </div>
                        </div>

                        <div class="col-md-12">
                            <label for="series" class="form-label">{{ 'HEADER.Series' | translate }}</label>
                            <input (keypress)="blockwhitespaces($event)" type="text" formControlName="series"
                                class="form-control" id="series" placeholder="{{ 'HEADER.Series' | translate }}" maxlength = 60>
                            <div *ngIf="spaForm.get('series')?.invalid && (spaForm.get('series')?.touched || spaForm.get('series')?.dirty)"
                                class="text-danger">
                                <span *ngIf="spaForm.get('series')?.hasError('required')">{{ 'HEADER.REQUIRED_Series' |
                                    translate }}</span>

                            </div>
                        </div>

                        <div class="col-md-12">
                            <label for="purchaseDate" class="form-label">{{ 'HEADER.PurchaseDate' | translate }}</label>
                            <input (keypress)="blockwhitespaces($event)" type="month" class="form-control"
                                formControlName="purchaseDate" id="purchaseDate" 
                                placeholder="YYYY-MM">
                            <div *ngIf="spaForm.get('purchaseDate')?.invalid && (spaForm.get('purchaseDate')?.touched || spaForm.get('purchaseDate')?.dirty)"
                                class="text-danger">
                                <span *ngIf="spaForm.get('purchaseDate')?.hasError('required')">{{
                                    'HEADER.REQUIRED_PurchaseDate' |
                                    translate }}</span>

                            </div>
                        </div>

                        <div class="col-md-12">
                            <label for="warrantyDate" class="form-label">{{ 'HEADER.WarrantyDate' | translate }}</label>
                            <input (keypress)="blockwhitespaces($event)" type="month" class="form-control"
                                formControlName="warrantydate" id="warrantyDate"
                                placeholder="YYYY-MM">
                        </div>
                    </div>




                    <div class="modal-footer">
                        <!-- <button type="button" class="btn btn-danger" data-bs-dismiss="modal">{{ 'HEADER.Close' |
                            translate }}</button> -->
                        <button (click)="onSubmitspa()" type="button" class="btn btn-primary">{{ 'HEADER.SaveChanges' |
                            translate }}</button>
                        <button (click)="actionbutton('deletespa')" [disabled]="isSpaDeleteButtonDisabled" type="button"
                            class="btn btn-danger">{{ 'HEADER.Delete' |
                            translate }}</button>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="deleteclient" tabindex="-1" aria-labelledby="secondModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="secondModalLabel">{{ modalTitle }}</h5>
                <button type="button" id="closemodal" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {{ modalMessage }}
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" *ngIf="isdeletebutton" class="btn btn-danger"
                        (click)="confirmDeleteSpa('client')">Delete</button>
                </div>
            </div>

        </div>
    </div>
</div>
